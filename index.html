<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Kiểm Tra Toán 11 - Đề Số 3 (Đã sửa giao diện)</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --light: #f8f9fa; --dark: #343a40; }
        body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; line-height: 1.6; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        .wrapper { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        /* Header */
        .exam-header { text-align: center; border-bottom: 3px solid var(--primary); padding-bottom: 20px; margin-bottom: 40px; }
        .exam-header h1 { margin: 0; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        .exam-info { color: #666; margin-top: 10px; font-style: italic; }

        /* Timer Fixed */
        .timer-badge { position: fixed; top: 20px; right: 20px; background: #fff; border: 2px solid var(--danger); color: var(--danger); padding: 10px 20px; border-radius: 30px; font-weight: bold; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(220, 53, 69, 0.2); z-index: 999; }

        /* Sections */
        .section-label { background: var(--dark); color: white; display: inline-block; padding: 8px 15px; border-radius: 5px; margin-top: 30px; margin-bottom: 15px; font-weight: bold; text-transform: uppercase; font-size: 0.9rem; }
        
        /* Questions */
        .q-item { margin-bottom: 25px; background: #fff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; transition: all 0.3s ease; }
        .q-item:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(0,123,255,0.1); }
        .q-text { font-weight: 600; font-size: 1.05rem; display: block; margin-bottom: 15px; }

        /* MCQ Grid */
        .mcq-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .mcq-grid { grid-template-columns: 1fr; } }
        .mcq-opt { display: flex; align-items: center; padding: 10px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
        .mcq-opt:hover { background-color: #e9ecef; }
        .mcq-opt input { margin-right: 12px; transform: scale(1.2); }

        /* --- SỬA LẠI CSS BẢNG ĐÚNG SAI --- */
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .tf-table th, .tf-table td { border: 1px solid #dee2e6; padding: 12px; vertical-align: middle; }
        
        /* Header bảng */
        .tf-table th { background-color: #e9ecef; text-align: center; font-weight: bold; }
        
        /* Cột Nội dung (Rộng nhất) */
        .tf-table td:first-child { width: 70%; text-align: left; }
        
        /* Cột Đúng và Cột Sai (Chia đều) */
        .tf-table th:nth-child(2), .tf-table th:nth-child(3),
        .tf-table td:nth-child(2), .tf-table td:nth-child(3) {
            width: 15%; /* Chia đều mỗi bên 15% */
            text-align: center; /* Căn giữa nút */
            background-color: #fcfcfc;
        }

        /* Nút radio trong bảng */
        .tf-radio { 
            transform: scale(1.5); /* Phóng to nút để dễ bấm */
            cursor: pointer; 
            accent-color: var(--primary); /* Màu xanh khi chọn */
        }

        /* Short Answer Input */
        .sa-input { width: 100%; max-width: 250px; padding: 10px; border: 2px solid #ced4da; border-radius: 5px; font-size: 1rem; transition: border-color 0.3s; }
        .sa-input:focus { border-color: var(--primary); outline: none; }

        /* Feedback & Result */
        .feedback { margin-top: 15px; padding: 15px; border-radius: 6px; font-size: 0.95rem; background-color: #f8f9fa; border-left: 4px solid #6c757d; display: none; }
        .feedback.correct { border-color: var(--success); background-color: #d4edda; color: #155724; }
        .feedback.wrong { border-color: var(--danger); background-color: #f8d7da; color: #721c24; }
        
        .result-box { text-align: center; padding: 30px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 10px; margin-bottom: 30px; display: none; }
        .result-score { font-size: 3rem; font-weight: bold; color: #333; margin: 10px 0; }

        /* Button */
        .btn-finish { display: block; width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .btn-finish:hover { background: #0056b3; transform: translateY(-2px); }

    </style>
</head>
<body>

<div class="timer-badge" id="timer">45:00</div>

<div class="wrapper">
    <div class="exam-header">
        <h1>ĐỀ KIỂM TRA HỌC KỲ 1 - TOÁN 11 (ĐỀ 3)</h1>
        <div class="exam-info">Thời gian: 45 phút | Cấu trúc Ma trận Đặc tả Mới</div>
    </div>

    <div class="result-box" id="resultBox">
        <h2>KẾT QUẢ BÀI LÀM</h2>
        <div class="result-score" id="scoreDisplay">0.0</div>
        <p id="resultMsg">Hãy xem lại chi tiết lời giải bên dưới.</p>
        <button onclick="location.reload()" style="padding:10px 20px; border:none; border-radius:5px; cursor:pointer;">Làm lại đề này</button>
    </div>

    <form id="quizForm">
        <div class="section-label">PHẦN I: TRẮC NGHIỆM (3.0 Điểm)</div>

        <div class="q-item" id="q1">
            <span class="q-text">Câu 1: Cho góc \(\alpha\) thỏa mãn \(\frac{\pi}{2} < \alpha < \pi\). Khẳng định nào sau đây đúng?</span>
            <div class="mcq-grid">
                <label class="mcq-opt"><input type="radio" name="q1" value="A"> A. \(\sin\alpha > 0, \cos\alpha > 0\)</label>
                <label class="mcq-opt"><input type="radio" name="q1" value="B"> B. \(\sin\alpha > 0, \cos\alpha < 0\)</label>
                <label class="mcq-opt"><input type="radio" name="q1" value="C"> C. \(\sin\alpha < 0, \cos\alpha > 0\)</label>
                <label class="mcq-opt"><input type="radio" name="q1" value="D"> D. \(\sin\alpha < 0, \cos\alpha < 0\)</label>
            </div>
            <div class="feedback"><b>Đáp án đúng: B</b>. Góc phần tư thứ II thì sin dương, cos âm.</div>
        </div>
        <div class="q-item" id="q2"><span class="q-text">Câu 2: Nghiệm của phương trình \(2\sin x - 1 = 0\) là:</span><div class="mcq-grid"><label class="mcq-opt"><input type="radio" name="q2" value="A"> A. ...</label><label class="mcq-opt"><input type="radio" name="q2" value="B"> B. \(x = \frac{\pi}{6} + k2\pi; x = \frac{5\pi}{6} + k2\pi\)</label><label class="mcq-opt"><input type="radio" name="q2" value="C"> C. ...</label><label class="mcq-opt"><input type="radio" name="q2" value="D"> D. ...</label></div><div class="feedback"><b>Đáp án đúng: B</b></div></div>
        
        <div class="section-label">PHẦN II: ĐÚNG / SAI (4.0 Điểm)</div>

        <div class="q-item" id="tf1">
            <span class="q-text">Câu 1: Cho phương trình lượng giác \(\tan\left(x + \frac{\pi}{3}\right) = 1\).</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Mệnh đề</th>
                        <th>Đúng</th> <th>Sai</th>  </tr>
                </thead>
                <tbody>
                    <tr data-ans="T">
                        <td>a) Điều kiện xác định là \(x \neq \frac{\pi}{6} + k\pi\).</td>
                        <td><input type="radio" name="tf1a" value="T" class="tf-radio"></td> <td><input type="radio" name="tf1a" value="F" class="tf-radio"></td> </tr>
                    <tr data-ans="F">
                        <td>b) Phương trình tương đương \(\tan\left(x + \frac{\pi}{3}\right) = \tan\frac{\pi}{6}\).</td>
                        <td><input type="radio" name="tf1b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>c) Nghiệm của phương trình là \(x = -\frac{\pi}{12} + k\pi\).</td>
                        <td><input type="radio" name="tf1c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>d) Phương trình có 2 nghiệm thuộc khoảng \((0; \pi)\).</td>
                        <td><input type="radio" name="tf1d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback">
                <b>Giải thích:</b> ... (Giữ nguyên giải thích cũ)
            </div>
        </div>

        <div class="q-item" id="tf2">
            <span class="q-text">Câu 2: Gửi tiết kiệm lãi kép.</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Mệnh đề</th>
                        <th>Đúng</th>
                        <th>Sai</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ans="T">
                        <td>a) Dãy số \((T_n)\) là một cấp số nhân.</td>
                        <td><input type="radio" name="tf2a" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2a" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>b) Công bội của cấp số nhân là \(q = 1,06\).</td>
                        <td><input type="radio" name="tf2b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>c) Số tiền sau 1 năm là 105 triệu đồng.</td>
                        <td><input type="radio" name="tf2c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>d) Công thức tính tiền sau \(n\) năm là \(T_n = 100 \cdot (1,06)^n\).</td>
                        <td><input type="radio" name="tf2d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback"><b>Giải thích:</b> c) Sai. 106 triệu.</div>
        </div>

        <div class="q-item" id="tf3">
            <span class="q-text">Câu 3: Cho hình chóp \(S.ABCD\).</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Mệnh đề</th>
                        <th>Đúng</th>
                        <th>Sai</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ans="T">
                        <td>a) Giao tuyến \((SAB)\) và \((SCD)\) song song \(AB\).</td>
                        <td><input type="radio" name="tf3a" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3a" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>b) \(CD\) cắt mặt phẳng \((SAB)\).</td>
                        <td><input type="radio" name="tf3b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>c) \(CD // (SAB)\).</td>
                        <td><input type="radio" name="tf3c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>d) \(AB\) và \(CD\) chéo nhau.</td>
                        <td><input type="radio" name="tf3d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback"><b>Giải thích:</b> ...</div>
        </div>

        <div class="section-label">PHẦN III: TRẢ LỜI NGẮN (3.0 Điểm)</div>

        <div class="q-item" id="sa1">
            <span class="q-text">Câu 1: Tính giới hạn... (Kết quả thập phân).</span>
            <input type="number" step="0.1" class="sa-input" id="input_sa1" placeholder="Nhập kết quả...">
            <div class="feedback"><b>Đáp án: 0.5</b></div>
        </div>

        <div class="q-item" id="sa2">
            <span class="q-text">Câu 2: Hồ nước bốc hơi 5%...</span>
            <input type="number" class="sa-input" id="input_sa2" placeholder="Nhập số nguyên...">
            <div class="feedback"><b>Đáp án: 5987</b></div>
        </div>

        <div class="q-item" id="sa3">
            <span class="q-text">Câu 3: Diện tích tam giác...</span>
            <input type="number" class="sa-input" id="input_sa3" placeholder="Nhập diện tích...">
            <div class="feedback"><b>Đáp án: 12</b></div>
        </div>

        <button type="button" class="btn-finish" onclick="submitExam()">NỘP BÀI VÀ XEM ĐIỂM</button>
    </form>
</div>

<script>
    // --- TIMER ---
    let timeSeconds = 45 * 60;
    const timerDisplay = document.getElementById('timer');
    
    const interval = setInterval(() => {
        const m = Math.floor(timeSeconds / 60);
        const s = timeSeconds % 60;
        timerDisplay.textContent = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        timeSeconds--;

        if (timeSeconds < 0) {
            clearInterval(interval);
            alert("Hết giờ làm bài!");
            submitExam();
        }
    }, 1000);

    // --- GRADING ---
    function submitExam() {
        clearInterval(interval);
        let score = 0;

        // 1. MCQ (0.3đ / câu) - Lược giản để demo, bạn thêm đủ 10 câu vào key
        const keyMCQ = { q1:'B', q2:'B' /* Thêm các câu khác */ };
        
        for (let q in keyMCQ) {
            const userAns = document.querySelector(`input[name="${q}"]:checked`);
            const div = document.getElementById(q);
            if(div) { // Kiểm tra nếu div tồn tại (do code trên mình rút gọn)
                const feed = div.querySelector('.feedback');
                feed.style.display = 'block';

                if (userAns && userAns.value === keyMCQ[q]) {
                    score += 0.3;
                    div.style.borderLeft = "5px solid var(--success)";
                    feed.classList.add('correct');
                } else {
                    div.style.borderLeft = "5px solid var(--danger)";
                    feed.classList.add('wrong');
                }
            }
        }

        // 2. TRUE/FALSE
        const keyTF = {
            tf1: ['T', 'F', 'T', 'F'],
            tf2: ['T', 'T', 'F', 'T'],
            tf3: ['T', 'F', 'T', 'F']
        };

        for (let qID in keyTF) {
            const rows = document.querySelectorAll(`#${qID} tbody tr`);
            const feed = document.querySelector(`#${qID} .feedback`);
            feed.style.display = 'block';
            let correctCount = 0;

            rows.forEach((row, index) => {
                const userT = row.querySelector('input[value="T"]').checked;
                const userF = row.querySelector('input[value="F"]').checked;
                const correctVal = keyTF[qID][index]; 

                let userVal = userT ? 'T' : (userF ? 'F' : null);
                
                // Logic tô màu
                if (userVal === correctVal) {
                    correctCount++;
                    row.style.background = "#d4edda"; // Màu xanh nếu đúng
                } else {
                    row.style.background = "#f8d7da"; // Màu đỏ nếu sai
                }
            });

            // Cộng điểm: (4 điểm tổng / 12 ý nhỏ)
            score += correctCount * (4.0 / 12.0);
        }

        // 3. SHORT ANSWER
        const keySA = {
            input_sa1: 0.5,
            input_sa2: 5987,
            input_sa3: 12
        };

        for (let id in keySA) {
            const input = document.getElementById(id);
            const div = document.getElementById(id.replace('input_', ''));
            const feed = div.querySelector('.feedback');
            feed.style.display = 'block';
            
            let val = parseFloat(input.value);
            
            if (Math.abs(val - keySA[id]) < 0.1) {
                score += 1.0;
                div.style.borderLeft = "5px solid var(--success)";
                feed.classList.add('correct');
            } else {
                div.style.borderLeft = "5px solid var(--danger)";
                feed.classList.add('wrong');
            }
        }

        // HIỂN THỊ KẾT QUẢ
        const resultBox = document.getElementById('resultBox');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const resultMsg = document.getElementById('resultMsg');
        
        resultBox.style.display = 'block';
        scoreDisplay.textContent = score.toFixed(1) + " / 10";
        
        if (score >= 8.0) resultMsg.textContent = "Tuyệt vời! Kiến thức của bạn rất vững.";
        else if (score >= 5.0) resultMsg.textContent = "Khá tốt! Hãy ôn lại các câu làm sai.";
        else resultMsg.textContent = "Cần cố gắng nhiều hơn ở lần sau nhé!";

        window.scrollTo(0,0);
        
        // Disable inputs
        document.querySelectorAll('input').forEach(i => i.disabled = true);
        document.querySelector('.btn-finish').style.display = 'none';
    }
</script>

</body>
</html>
