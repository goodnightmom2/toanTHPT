<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Kiểm Tra Toán 11 - Đề 3 </title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --bg: #f4f6f9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* Header */
        .exam-header { text-align: center; border-bottom: 3px solid var(--primary); padding-bottom: 20px; margin-bottom: 30px; }
        .exam-header h1 { color: var(--primary); margin: 0; font-size: 1.8rem; text-transform: uppercase; }
        .exam-header p { color: #666; font-style: italic; margin-top: 5px; }

        /* Timer */
        .sticky-timer { position: fixed; top: 15px; right: 15px; background: white; border: 2px solid var(--danger); color: var(--danger); padding: 8px 15px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 1000; }

        /* Sections */
        .section-title { background-color: #343a40; color: white; padding: 10px 15px; border-radius: 5px; margin: 30px 0 20px 0; font-weight: bold; font-size: 1.1rem; text-transform: uppercase; border-left: 5px solid var(--primary); }

        /* Question Box */
        .question-box { background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px; transition: transform 0.2s; }
        .question-box:hover { border-color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .q-content { font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.05rem; }

        /* MCQ Options */
        .options-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-label { display: flex; align-items: center; padding: 10px; border: 1px solid #e9ecef; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
        .option-label:hover { background-color: #e2e6ea; }
        .option-label input { margin-right: 12px; transform: scale(1.2); }

        /* --- CSS CHO BẢNG ĐÚNG SAI (Đã tối ưu hóa giao diện) --- */
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 15px; table-layout: fixed; }
        .tf-table th, .tf-table td { border: 1px solid #dee2e6; padding: 12px; vertical-align: middle; }
        
        /* Header */
        .tf-table th { background-color: #f8f9fa; font-weight: bold; text-align: center; color: #495057; }
        
        /* Cột nội dung (Rộng 70%) */
        .tf-table td:first-child { width: 70%; text-align: left; }
        
        /* Cột Đúng/Sai (Rộng 15% mỗi cột) */
        .tf-table th:nth-child(2), .tf-table th:nth-child(3),
        .tf-table td:nth-child(2), .tf-table td:nth-child(3) { 
            width: 15%; 
            text-align: center; 
            background-color: #ffffff;
        }
        
        /* Hiệu ứng khi hover vào hàng */
        .tf-table tbody tr:hover { background-color: #fcfcfc; }

        /* Radio button to hơn */
        .tf-radio { 
            transform: scale(1.6); 
            cursor: pointer; 
            accent-color: var(--primary); /* Màu xanh của bootstrap */
            margin: 0;
        }

        /* Short Answer */
        .input-short { width: 100%; max-width: 300px; padding: 10px; border: 2px solid #dee2e6; border-radius: 5px; font-size: 1rem; transition: border-color 0.3s; }
        .input-short:focus { border-color: var(--primary); outline: none; }

        /* Feedback & Results */
        .result-panel { display: none; text-align: center; background: #d4edda; padding: 30px; border-radius: 10px; margin-bottom: 30px; border: 2px solid #c3e6cb; color: #155724; }
        .score-big { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        
        .feedback { margin-top: 15px; padding: 12px; border-radius: 6px; font-size: 0.95rem; display: none; }
        .feedback.correct { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .feedback.wrong { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }

        /* Button */
        .btn-submit { display: block; width: 100%; background: var(--primary); color: white; padding: 16px; font-size: 1.2rem; border: none; border-radius: 8px; cursor: pointer; margin-top: 40px; font-weight: bold; text-transform: uppercase; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: background 0.3s; }
        .btn-submit:hover { background: #0069d9; }

        @media (max-width: 600px) { .options-list { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="sticky-timer" id="timer">45:00</div>

<div class="container">
    <div class="exam-header">
        <h1>ĐỀ KIỂM TRA CUỐI KỲ 1 (ĐỀ 5)</h1>
        <p>Môn: Toán 11 | Thời gian: 45 phút</p>
    </div>

    <div class="result-panel" id="resultPanel">
        <h2>KẾT QUẢ BÀI LÀM</h2>
        <div class="score-big" id="finalScore">0.00</div>
        <p id="finalMsg">Hãy xem chi tiết đáp án và giải thích bên dưới.</p>
        <button onclick="location.reload()" style="padding: 10px 20px; cursor:pointer; margin-top:10px; border-radius: 5px; border:none;">Làm lại đề này</button>
    </div>

    <form id="quizForm">
        <div class="section-title">PHẦN I: TRẮC NGHIỆM (3.0 điểm)</div>

        <div class="question-box" id="q1">
            <span class="q-content">Câu 1: Công thức nào sau đây đúng?</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q1" value="A"> A. \(\tan x \cdot \cot x = 1\)</label>
                <label class="option-label"><input type="radio" name="q1" value="B"> B. \(\sin^2 x - \cos^2 x = 1\)</label>
                <label class="option-label"><input type="radio" name="q1" value="C"> C. \(1 + \tan^2 x = \frac{1}{\sin^2 x}\)</label>
                <label class="option-label"><input type="radio" name="q1" value="D"> D. \(\sin 2x = \sin x + \cos x\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Đây là hằng đẳng thức lượng giác cơ bản.</div>
        </div>

        <div class="question-box" id="q2">
            <span class="q-content">Câu 2: Phương trình \(\sin x = -1\) có nghiệm là:</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q2" value="A"> A. \(x = -\frac{\pi}{2} + k2\pi\)</label>
                <label class="option-label"><input type="radio" name="q2" value="B"> B. \(x = \frac{\pi}{2} + k2\pi\)</label>
                <label class="option-label"><input type="radio" name="q2" value="C"> C. \(x = k\pi\)</label>
                <label class="option-label"><input type="radio" name="q2" value="D"> D. \(x = \pi + k2\pi\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Điểm ngọn cung \(-\pi/2\) trên đường tròn lượng giác có tung độ bằng -1.</div>
        </div>

        <div class="question-box" id="q3">
            <span class="q-content">Câu 3: Cho cấp số cộng \((u_n)\) có \(u_1=2, u_2=5\). Công sai \(d\) bằng:</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q3" value="A"> A. 3</label>
                <label class="option-label"><input type="radio" name="q3" value="B"> B. -3</label>
                <label class="option-label"><input type="radio" name="q3" value="C"> C. 2.5</label>
                <label class="option-label"><input type="radio" name="q3" value="D"> D. 10</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. \(d = u_2 - u_1 = 5 - 2 = 3\).</div>
        </div>

        <div class="question-box" id="q4">
            <span class="q-content">Câu 4: Cho cấp số nhân \((u_n)\) với công bội \(q=2\) và \(u_1=3\). Số hạng tổng quát \(u_n\) là:</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q4" value="A"> A. \(u_n = 3 \cdot 2^{n-1}\)</label>
                <label class="option-label"><input type="radio" name="q4" value="B"> B. \(u_n = 3 \cdot 2^n\)</label>
                <label class="option-label"><input type="radio" name="q4" value="C"> C. \(u_n = 3 + (n-1)2\)</label>
                <label class="option-label"><input type="radio" name="q4" value="D"> D. \(u_n = 2 \cdot 3^{n-1}\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Công thức \(u_n = u_1 \cdot q^{n-1}\).</div>
        </div>

        <div class="question-box" id="q5">
            <span class="q-content">Câu 5: \(\lim_{n \to +\infty} \frac{3n - 1}{n + 2}\) bằng:</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q5" value="A"> A. 3</label>
                <label class="option-label"><input type="radio" name="q5" value="B"> B. 1</label>
                <label class="option-label"><input type="radio" name="q5" value="C"> C. -1/2</label>
                <label class="option-label"><input type="radio" name="q5" value="D"> D. 0</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Bậc tử bằng bậc mẫu, giới hạn là tỉ số hệ số cao nhất: \(3/1 = 3\).</div>
        </div>

        <div class="question-box" id="q6">
            <span class="q-content">Câu 6: \(\lim_{x \to 3} (2x^2 - 1)\) bằng:</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q6" value="A"> A. 17</label>
                <label class="option-label"><input type="radio" name="q6" value="B"> B. 11</label>
                <label class="option-label"><input type="radio" name="q6" value="C"> C. 5</label>
                <label class="option-label"><input type="radio" name="q6" value="D"> D. \(\infty\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Thay trực tiếp: \(2(3^2) - 1 = 18 - 1 = 17\).</div>
        </div>

        <div class="question-box" id="q7">
            <span class="q-content">Câu 7: Hàm số \(f(x) = \frac{1}{x}\) gián đoạn tại điểm nào?</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q7" value="A"> A. \(x = 0\)</label>
                <label class="option-label"><input type="radio" name="q7" value="B"> B. \(x = 1\)</label>
                <label class="option-label"><input type="radio" name="q7" value="C"> C. \(x = -1\)</label>
                <label class="option-label"><input type="radio" name="q7" value="D"> D. Hàm số liên tục trên \(\mathbb{R}\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Hàm số không xác định tại \(x=0\) nên gián đoạn tại đó.</div>
        </div>

        <div class="question-box" id="q8">
            <span class="q-content">Câu 8: Cho hình chóp \(S.ABCD\) có đáy là hình bình hành. Đường thẳng \(AB\) song song với mặt phẳng nào?</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q8" value="A"> A. \((SCD)\)</label>
                <label class="option-label"><input type="radio" name="q8" value="B"> B. \((SBC)\)</label>
                <label class="option-label"><input type="radio" name="q8" value="C"> C. \((SAD)\)</label>
                <label class="option-label"><input type="radio" name="q8" value="D"> D. \((SAC)\)</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Vì \(AB // CD\) và \(CD \subset (SCD)\).</div>
        </div>

        <div class="question-box" id="q9">
            <span class="q-content">Câu 9: Trong không gian, qua một điểm nằm ngoài mặt phẳng \((P)\), có bao nhiêu mặt phẳng song song với \((P)\)?</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q9" value="A"> A. Duy nhất 1</label>
                <label class="option-label"><input type="radio" name="q9" value="B"> B. 0</label>
                <label class="option-label"><input type="radio" name="q9" value="C"> C. 2</label>
                <label class="option-label"><input type="radio" name="q9" value="D"> D. Vô số</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. Định lý về sự tồn tại và duy nhất của mặt phẳng song song.</div>
        </div>

        <div class="question-box" id="q10">
            <span class="q-content">Câu 10: Cho mẫu số liệu ghép nhóm về chiều cao học sinh. Nhóm chứa mốt là nhóm [150; 155) với tần số là 15 (lớn nhất). Giá trị mốt \(M_o\) xấp xỉ bằng bao nhiêu nếu biết tần số nhóm trước là 5 và nhóm sau là 10?</span>
            <div class="options-list">
                <label class="option-label"><input type="radio" name="q10" value="A"> A. 153.33</label>
                <label class="option-label"><input type="radio" name="q10" value="B"> B. 152</label>
                <label class="option-label"><input type="radio" name="q10" value="C"> C. 154</label>
                <label class="option-label"><input type="radio" name="q10" value="D"> D. 151</label>
            </div>
            <div class="feedback"><b>Đáp án: A</b>. \(M_o = 150 + \frac{15-5}{(15-5)+(15-10)} \cdot 5 = 150 + \frac{10}{15} \cdot 5 \approx 153.33\).</div>
        </div>

        <div class="section-title">PHẦN II: ĐÚNG / SAI (4.0 điểm)</div>

        <div class="question-box" id="tf1">
            <span class="q-content">Câu 1: Cho phương trình lượng giác \(\cos 2x = \frac{1}{2}\).</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Nội dung</th>
                        <th>Đúng</th>
                        <th>Sai</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ans="F">
                        <td>a) Điều kiện xác định của phương trình là \(x \ne \frac{\pi}{2} + k\pi\).</td>
                        <td><input type="radio" name="tf1a" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1a" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>b) Phương trình tương đương với \(\cos 2x = \cos \frac{\pi}{3}\).</td>
                        <td><input type="radio" name="tf1b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>c) Nghiệm của phương trình là \(x = \pm \frac{\pi}{6} + k\pi\).</td>
                        <td><input type="radio" name="tf1c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>d) Trong khoảng \((0; \pi)\), phương trình có 2 nghiệm phân biệt.</td>
                        <td><input type="radio" name="tf1d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf1d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback">
                <b>Giải thích:</b> a) Sai, hàm cos xác định trên R. d) Đúng, 2 nghiệm là \(\pi/6\) và \(5\pi/6\) (do \(-\pi/6 + \pi = 5\pi/6\)).
            </div>
        </div>

        <div class="question-box" id="tf2">
            <span class="q-content">Câu 2: Cước phí gửi hàng qua bưu điện được tính như sau: Dưới 5kg giá 30 nghìn đồng. Từ 5kg trở lên, mỗi kg tính thêm 4 nghìn đồng. Hàm số biểu thị giá cước \(C(x)\) theo khối lượng \(x\) (kg).</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Nội dung</th>
                        <th>Đúng</th>
                        <th>Sai</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ans="T">
                        <td>a) Hàm số chi phí là \(C(x) = \begin{cases} 30 & 0 < x \le 5 \\ 30 + 4(x-5) & x > 5 \end{cases}\).</td>
                        <td><input type="radio" name="tf2a" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2a" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>b) Giá cước cho kiện hàng 10kg là 40 nghìn đồng.</td>
                        <td><input type="radio" name="tf2b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>c) \(\lim_{x \to 5^+} C(x) = 30\).</td>
                        <td><input type="radio" name="tf2c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>d) Hàm số liên tục trên khoảng \((0; +\infty)\).</td>
                        <td><input type="radio" name="tf2d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf2d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback">
                <b>Giải thích:</b> b) Sai. \(C(10) = 30 + 4(10-5) = 30 + 20 = 50\) nghìn.
            </div>
        </div>

        <div class="question-box" id="tf3">
            <span class="q-content">Câu 3: Cho hình chóp \(S.ABCD\) có đáy \(ABCD\) là hình bình hành. Gọi \(M\) là trung điểm \(SA\).</span>
            <table class="tf-table">
                <thead>
                    <tr>
                        <th>Nội dung</th>
                        <th>Đúng</th>
                        <th>Sai</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ans="T">
                        <td>a) Giao tuyến của \((SAC)\) và \((SBD)\) là đường thẳng \(SO\) (O là tâm đáy).</td>
                        <td><input type="radio" name="tf3a" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3a" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>b) Đường thẳng \(OM\) song song với mặt phẳng \((SBC)\).</td>
                        <td><input type="radio" name="tf3b" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3b" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="T">
                        <td>c) Đường thẳng \(OM\) song song với mặt phẳng \((SCD)\).</td>
                        <td><input type="radio" name="tf3c" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3c" value="F" class="tf-radio"></td>
                    </tr>
                    <tr data-ans="F">
                        <td>d) \(SA\) và \(CD\) cắt nhau.</td>
                        <td><input type="radio" name="tf3d" value="T" class="tf-radio"></td>
                        <td><input type="radio" name="tf3d" value="F" class="tf-radio"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback">
                <b>Giải thích:</b> b) Sai. M trung điểm SA, O trung điểm AC => MO là đường trung bình tam giác SAC => \(MO // SC\). Mà \(SC \subset (SBC)\) nên \(MO // (SBC)\). Đợi đã, \(MO // SC\) thì \(MO\) song song với mọi mặt phẳng chứa \(SC\)? Đúng. Vậy ý b là **Đúng**. 
                *Chỉnh lại logic đề bài:* Để ý b thành Sai, ta sửa đề: "b) OM song song với (SAB)". Sai vì M thuộc (SAB). Nhưng với đề hiện tại \(OM // SC \subset (SBC)\) là Đúng. Ta sửa đáp án trong code JS để khớp với thực tế hình học. Ở đây tôi sẽ sửa lại logic đáp án JS là T cho ý b.
                *Tuy nhiên*, để tạo câu Sai cho đề phong phú: d) Sai vì SA và CD chéo nhau.
            </div>
        </div>

        <div class="section-title">PHẦN III: TRẢ LỜI NGẮN (3.0 điểm)</div>

        <div class="question-box" id="sa1">
            <span class="q-content">Câu 1: Một quả bóng được thả rơi từ độ cao 20m. Sau mỗi lần chạm đất, quả bóng nảy lên độ cao bằng 1/2 độ cao trước đó. Hỏi sau lần chạm đất thứ 5, quả bóng nảy lên độ cao bao nhiêu mét? (Nhập số thập phân).</span>
            <input type="number" step="0.001" class="input-short" id="input_sa1" placeholder="Nhập kết quả...">
            <div class="feedback"><b>Đáp án: 0.625</b>. <br> Cấp số nhân: \(u_1 = 20 \times 0.5 = 10\) (lần 1), ..., \(h_5 = 20 \times (0.5)^5 = 20 \times 0.03125 = 0.625\) m.</div>
        </div>

        <div class="question-box" id="sa2">
            <span class="q-content">Câu 2: Tìm giá trị của tham số \(m\) để hàm số \(f(x) = \begin{cases} \frac{x^2-4}{x-2} & x \ne 2 \\ mx + 1 & x = 2 \end{cases}\) liên tục tại \(x=2\).</span>
            <input type="number" step="0.1" class="input-short" id="input_sa2" placeholder="Nhập giá trị m...">
            <div class="feedback"><b>Đáp án: 1.5</b>. <br> \(\lim_{x \to 2} (x+2) = 4\). Để liên tục: \(2m+1 = 4 \Rightarrow 2m=3 \Rightarrow m=1.5\).</div>
        </div>

        <div class="question-box" id="sa3">
            <span class="q-content">Câu 3: Ba mặt phẳng song song cắt hai đường thẳng chéo nhau \(a, b\) lần lượt tại \(A, B, C\) và \(A', B', C'\). Biết \(AB = 3, BC = 6, A'B' = 4\). Tính độ dài \(B'C'\).</span>
            <input type="number" class="input-short" id="input_sa3" placeholder="Nhập độ dài...">
            <div class="feedback"><b>Đáp án: 8</b>. <br> Thales không gian: \(AB/BC = A'B'/B'C' \Rightarrow 3/6 = 4/x \Rightarrow x = 8\).</div>
        </div>

        <button type="button" class="btn-submit" onclick="submitExam()">Nộp bài và xem điểm</button>
    </form>
</div>

<script>
    // --- Timer Logic ---
    let time = 45 * 60;
    const timerEl = document.getElementById('timer');
    const interval = setInterval(() => {
        let m = Math.floor(time / 60);
        let s = time % 60;
        timerEl.textContent = `${m}:${s < 10 ? '0'+s : s}`;
        time--;
        if(time < 0) {
            clearInterval(interval);
            alert("Hết giờ làm bài!");
            submitExam();
        }
    }, 1000);

    // --- Grading Logic ---
    function submitExam() {
        clearInterval(interval);
        let score = 0;

        // 1. Chấm Trắc nghiệm (10 câu)
        const keyMCQ = { q1:'A', q2:'A', q3:'A', q4:'A', q5:'A', q6:'A', q7:'A', q8:'A', q9:'A', q10:'A' };
        
        for (let q in keyMCQ) {
            const userChoice = document.querySelector(`input[name="${q}"]:checked`);
            const box = document.getElementById(q);
            const feed = box.querySelector('.feedback');
            feed.style.display = 'block';

            if(userChoice && userChoice.value === keyMCQ[q]) {
                score += 0.3;
                box.style.borderLeft = "5px solid var(--success)";
                feed.className = 'feedback correct';
            } else {
                box.style.borderLeft = "5px solid var(--danger)";
                feed.className = 'feedback wrong';
            }
        }

        // 2. Chấm Đúng/Sai (3 câu)
        const keyTF = {
            tf1: ['F', 'T', 'T', 'T'],
            tf2: ['T', 'F', 'T', 'T'],
            tf3: ['T', 'T', 'T', 'F'] // b=T vì OM // SC // (SBC)
        };

        for (let id in keyTF) {
            const rows = document.querySelectorAll(`#${id} tbody tr`);
            const feed = document.querySelector(`#${id} .feedback`);
            feed.style.display = 'block';
            let correctCount = 0;

            rows.forEach((row, idx) => {
                const t = row.querySelector('input[value="T"]').checked;
                const f = row.querySelector('input[value="F"]').checked;
                const correctVal = keyTF[id][idx];
                
                let userVal = t ? 'T' : (f ? 'F' : '');
                
                if(userVal === correctVal) {
                    correctCount++;
                    row.style.backgroundColor = "#d1e7dd"; // Green tint
                } else {
                    row.style.backgroundColor = "#f8d7da"; // Red tint
                }
            });
            // 4.0 điểm / 12 ý = 0.333 điểm/ý
            score += correctCount * (4.0 / 12.0);
        }

        // 3. Chấm Trả lời ngắn (3 câu)
        const keySA = {
            input_sa1: 0.625,
            input_sa2: 1.5,
            input_sa3: 8
        };

        for (let id in keySA) {
            const input = document.getElementById(id);
            const box = document.getElementById(id.replace('input_', ''));
            const feed = box.querySelector('.feedback');
            feed.style.display = 'block';
            
            let val = parseFloat(input.value);
            // Sai số cho phép 0.1
            if(Math.abs(val - keySA[id]) < 0.1) {
                score += 1.0;
                box.style.borderLeft = "5px solid var(--success)";
                feed.className = 'feedback correct';
            } else {
                box.style.borderLeft = "5px solid var(--danger)";
                feed.className = 'feedback wrong';
            }
        }

        // Hiển thị kết quả
        const panel = document.getElementById('resultPanel');
        const finalScore = document.getElementById('finalScore');
        const finalMsg = document.getElementById('finalMsg');
        
        panel.style.display = 'block';
        finalScore.textContent = score.toFixed(2) + " / 10";
        
        if(score >= 8) finalMsg.textContent = "Làm tốt lắm! Kiến thức của em rất vững.";
        else if(score >= 5) finalMsg.textContent = "Đạt yêu cầu. Hãy ôn lại những phần làm sai nhé.";
        else finalMsg.textContent = "Cần cố gắng nhiều hơn nữa.";

        window.scrollTo(0, 0);
        
        // Disable form
        const inputs = document.querySelectorAll('input');
        inputs.forEach(i => i.disabled = true);
        document.querySelector('.btn-submit').style.display = 'none';
    }
</script>

</body>
</html>
